<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Insert title here</title>
<link  rel="stylesheet" type="text/css" href="css/basic.css"  />
<style type="text/css">
.poster {
	width : 150px;
	height : 150px;
}

a{text-decoration: none}

td {text-align: center;}
</style>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>

<script type="text/javascript">
	$(function() {
		function refreshPage() {
			let str = ""; 
			let toalprice = 0;
			for(let i=0; i < sessionStorage.length; i++) {
				let key = sessionStorage.key(i); //1001 
				let value = sessionStorage.getItem(key); //쿵푸팬더,img/movie_image2.jpg,3000

				//value의 값을 , 기준으로 분리
				let arr = value.split(",");

				str += `<tr>`;
				str += `<td><img src="${arr[1]}" class="poster"></td>`;
				str += `<td>${key}</td>`;
				str += `<td>${arr[0]}</td>`;
				str += `<td>${arr[2]}</td>`;
				str += `<td><button type='button' id='${key}' name='delItem'>삭제</button></td>`; 
				str += `</tr>`;

				//가격 누적
				toalprice += parseInt(arr[2]); //그냥 arr[2]만 가져오면 문자열로 인식함

			} //for문 끝

			//테이블에 추가
			$("#content").html(str);

			//가격 추가
			$("#price").html("<b>주문 가격: " + toalprice + "원</b>");

		} //함수 끝

		///// 정적 요소에 이벤트 적용 //////
		$(document).on("click", "[name=delItem]", function() { 
			if(confirm("삭제하시겠습니까?")) {
				let key = $(this).parent().parent().find("td:eq(1)").text() 
				sessionStorage.removeItem(key);

				refreshPage();
			}
		}); //삭제 끝
		
		$(document).on("click", "[name=delAllItem]", function() { 
			if(confirm("전체 삭제하시겠습니까?")) {
				sessionStorage.clear();
				
				refreshPage();
			}
		}); //삭제 끝

		refreshPage();
	});
	
	
	
</script>
</head>
<body>
	<button name="delAllItem">전체 삭제</button>
		<article class="main">
		<section>
			<table width="80%"  align="center" id="ta" >
			<caption class="caption">장바구니 리스트</caption>
			<thead>
				<tr><th>이미지</th><th>상품번호</th><th>상품이름</th><th>가격</th><th>삭제</th></tr>
			</thead>
			<tbody id="content">
				<!-- 찜 목록 출력 --> 
			</tbody>
			</table>
		</section>
		<section  class="toalprice" id="price">
			<!-- 가격 -->			
		</section>
		<section class="link">
			<table   align="center">
			<tr><td align="center">
				<a href="order.jsp">주문하러 가기</a> 
				<a href="index.html">DVD LIST</a> 
			</td></tr>
			</table>
		</section>
		</article>
</body>
</html>